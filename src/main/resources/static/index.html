<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>StreamFlix - Watch Movies</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-black text-white font-sans h-screen flex flex-col items-center justify-center"
      style="background-image: url('https://assets.nflxext.com/ffe/siteui/vlv3/f841d4c7-10e1-40af-bcae-07a3f8dc141a/f6d7434e-d6de-4185-a6d4-c77a2d08737b/US-en-20220502-popsignuptwoweeks-perspective_alpha_website_medium.jpg'); background-size: cover; background-blend-mode: overlay; background-color: rgba(0,0,0,0.6);">

<div class="bg-black bg-opacity-80 p-12 rounded-lg w-full max-w-md">
    <h1 class="text-4xl font-bold mb-8 text-red-600">StreamFlix</h1>

    <div id="login-form">
        <h2 class="text-2xl font-bold mb-6">Sign In</h2>
        <input id="l-email" type="email" placeholder="Email" class="w-full p-4 mb-4 rounded bg-gray-700 text-white focus:outline-none focus:bg-gray-600">
        <input id="l-pass" type="password" placeholder="Password" class="w-full p-4 mb-8 rounded bg-gray-700 text-white focus:outline-none focus:bg-gray-600">
        <button onclick="login()" class="w-full bg-red-600 p-4 rounded font-bold hover:bg-red-700 transition">Sign In</button>
        <p class="mt-4 text-gray-400">New here? <a href="#" onclick="toggleForm()" class="text-white hover:underline">Sign up now.</a></p>
    </div>

    <div id="reg-form" class="hidden">
        <h2 class="text-2xl font-bold mb-6">Sign Up</h2>
        <input id="r-email" type="email" placeholder="Email" class="w-full p-4 mb-4 rounded bg-gray-700 text-white focus:outline-none focus:bg-gray-600">
        <input id="r-pass" type="password" placeholder="Password" class="w-full p-4 mb-8 rounded bg-gray-700 text-white focus:outline-none focus:bg-gray-600">
        <button onclick="register()" class="w-full bg-red-600 p-4 rounded font-bold hover:bg-red-700 transition">Sign Up</button>
        <p class="mt-4 text-gray-400">Already have an account? <a href="#" onclick="toggleForm()" class="text-white hover:underline">Sign in.</a></p>
    </div>
</div>

<script>
    // Toggle between Login and Register
    function toggleForm() {
        document.getElementById('login-form').classList.toggle('hidden');
        document.getElementById('reg-form').classList.toggle('hidden');
    }

    async function login() {
        const email = document.getElementById('l-email').value;
        const password = document.getElementById('l-pass').value;

        try {
            const res = await fetch('/api/login', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({email, password})
            });
            const data = await res.json();

            if(data.status === 'success') {
                localStorage.setItem('userEmail', data.email);
                localStorage.setItem('userRole', data.role);
                // Redirect based on role
                window.location.href = data.role === 'ADMIN' ? 'admin.html' : 'dashboard.html';
            } else {
                alert('Login failed: ' + data.message);
            }
        } catch(e) { console.error(e); alert('Server error'); }
    }

    async function register() {
        const email = document.getElementById('r-email').value;
        const password = document.getElementById('r-pass').value;

        try {
            const res = await fetch('/api/register', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({email, password})
            });
            const data = await res.json();

            if(data.status === 'success') {
                alert('Registration successful! Please sign in.');
                toggleForm();
            } else {
                alert('Error: ' + data.message);
            }
        } catch(e) { console.error(e); alert('Server error'); }
    }
</script>
</body>
</html>
